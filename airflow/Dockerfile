FROM apache/airflow:2.11.0

LABEL authors="Jiaqi Zou"

ARG PROJECT_ID
ARG REGION
ARG CYGNSS_INGEST_JOB_NAME
ARG SMAP_INGEST_JOB_NAME
ARG CYGNSS_PREPROCESS_JOB_NAME
ARG SMAP_PREPROCESS_JOB_NAME
ARG INTEGRATION_JOB_NAME

ENV PROJECT_ID=$PROJECT_ID
ENV REGION=$REGION
ENV CYGNSS_INGEST_JOB_NAME=$CYGNSS_INGEST_JOB_NAME
ENV SMAP_INGEST_JOB_NAME=$SMAP_INGEST_JOB_NAME
ENV CYGNSS_PREPROCESS_JOB_NAME=$CYGNSS_PREPROCESS_JOB_NAME
ENV SMAP_PREPROCESS_JOB_NAME=$SMAP_PREPROCESS_JOB_NAME
ENV INTEGRATION_JOB_NAME=$INTEGRATION_JOB_NAME
ENV PYTHONPATH=/opt/airflow

COPY ./dags /opt/airflow/dags

COPY ./scripts /opt/airflow/scripts

COPY ./requirements.txt /opt/airflow/requirements.txt

RUN pip install --upgrade -r /opt/airflow/requirements.txt

USER airflow

CMD ["airflow", "standalone"]
